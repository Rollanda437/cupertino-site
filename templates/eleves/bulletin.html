<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Bulletin</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    @media print { .no-print { display: none; } body { font-size: 11px; } }
    .header { background: linear-gradient(135deg, #003366, #0055A4); color: white; padding: 20px; text-align: center; border-radius: 12px 12px 0 0; }
    table { font-size: 11px; }
  </style>
</head>
<body class="bg-light py-5">
  <div class="container">
    <div class="card shadow">
      <div class="header">
        <h1 class="mb-1">COLLÈGE SAINT JOSEPH DE CUPERTINO JUNIOR</h1>
        <h3>FICHE DE NOTES • <span id="classe">...</span> • S1 2025-2026</h3>
      </div>
      <div class="card-body" id="body">
        <div class="text-center my-5">
          <div class="spinner-border text-primary" style="width: 4rem; height: 4rem;"></div>
          <h4 class="mt-3">Chargement du bulletin…</h4>
        </div>
      </div>
    </div>
  </div>

  <script>
    // TA VRAIE CONFIG (celle que tu m’as donnée)
    const firebaseConfig = {
      apiKey: "AIzaSyCEbcDjcCpxIaLT8x1fOUqZX_M-8olJfrw",
      authDomain: "sjcj-site.firebaseapp.com",
      projectId: "sjcj-site",
      storageBucket: "sjcj-site.firebasestorage.app",
      messagingSenderId: "518949071104",
      appId: "1:518949071104:web:a5cf6e80b3a66f6e8f6be5"
    };

    // Chargement simple et sûr de Firebase
    const script = document.createElement("script");
    script.src = "https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js";
    script.onload = () => {
      const script2 = document.createElement("script");
      script2.src = "https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js";
      script2.onload = () => start();
      document.body.appendChild(script2);
    };
    document.body.appendChild(script);

    function start() {
      firebase.initializeApp(firebaseConfig);
      const db = firebase.firestore();

      // Récupère le code élève proprement
      let code = window.location.pathname.split("/").pop();
      if (code.endsWith("/")) code = code.slice(0, -1);
      if (!code) { document.getElementById("body").innerHTML = "<h3 class='text-danger text-center'>Code manquant</h3>"; return; }

      const MATIERES = {
        "1ere F4": ["FRANÇAIS","ANGLAIS","MATH","PCT","RDM","PE","DESSIN","SMC","TP","METRE","HYGIENE","PC"],
        "2nde F4": ["FRANÇAIS","ANGLAIS","MATH","PHYSIQUE","DESSIN","INFORMATIQUE","TM/TC","TP","MECANIQUE","PREVENTION","LEGIS"],
        "Tle F4": ["FRANÇAIS","ANGLAIS","MATH","PCT","RDM","PE","DESSIN","METRE","PC","BA","TP","LEGIS"],
        "2nde IMI": ["FRANÇAIS","ANGLAIS","MATH","EB","LA","AS","SEV","SER","ALGO","MATH APPLIQUE","LEGIS"],
        "Tle IMI": ["FRANÇAIS","ANGLAIS","MATH","EB","RESEAU","RP","MATH APPLIQUÉ","LEGIS","BD","PG","ELEC"]
        // ajoute les autres si besoin
      };

      db.collection("eleves").doc(code).get()
        .then(doc => {
          if (!doc.exists) throw "Élève non trouvé";
          const e = doc.data();
          document.getElementById("classe").textContent = e.classe || "...";

          let rows = "";
          (MATIERES[e.classe] || []).forEach(m => {
            rows += `<tr><td class="text-start fw-bold">${m}</td><td>—</td><td>—</td><td>—</td><td>—</td><td class="bg-light fw-bold">—</td><td>—</td><td>—</td><td class="bg-light fw-bold">—</td><td><span class="badge bg-secondary">—</span></td><td>—</td></tr>`;
          });

          document.getElementById("body").innerHTML = `
            <div class="text-center mb-4"><h4>${e.prenom} ${e.nom} • ${e.code_eleve}</h4></div>
            <table class="table table-bordered table-sm">
              <thead class="table-dark">
                <tr><th rowspan="2">Matières</th><th colspan="4">INTERROGATIONS</th><th rowspan="2">Moy.Inter</th><th colspan="2">DEVOIRS</th><th rowspan="2">Moy.Devoirs</th><th rowspan="2">Moy.Semestre</th><th rowspan="2">Appréciation</th></tr>
                <tr><th>1</th><th>2</th><th>3</th><th>4</th><th>1</th><th>2</th></tr>
              </thead>
              <tbody>${rows}</tbody>
            </table>
            <div class="text-center mt-4 no-print">
              <a href="/eleves/rechercher/" class="btn btn-secondary btn-lg">Retour</a>
              <button onclick="window.print()" class="btn btn-success btn-lg ms-3">PDF / Imprimer</button>
            </div>`;
        })
        .catch(err => {
          document.getElementById("body").innerHTML = `<h3 class="text-danger text-center">Erreur : ${err}</h3>`;
        });
    }
  </script>
</body>
</html><!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Bulletin</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    @media print { .no-print { display: none; } body { font-size: 11px; } }
    .header { background: linear-gradient(135deg, #003366, #0055A4); color: white; padding: 20px; text-align: center; border-radius: 12px 12px 0 0; }
    table { font-size: 11px; }
  </style>
</head>
<body class="bg-light py-5">
  <div class="container">
    <div class="card shadow">
      <div class="header">
        <h1 class="mb-1">COLLÈGE SAINT JOSEPH DE CUPERTINO JUNIOR</h1>
        <h3>FICHE DE NOTES • <span id="classe">...</span> • S1 2025-2026</h3>
      </div>
      <div class="card-body" id="body">
        <div class="text-center my-5">
          <div class="spinner-border text-primary" style="width: 4rem; height: 4rem;"></div>
          <h4 class="mt-3">Chargement du bulletin…</h4>
        </div>
      </div>
    </div>
  </div>

  <script>
    // TA VRAIE CONFIG (celle que tu m’as donnée)
    const firebaseConfig = {
      apiKey: "AIzaSyCEbcDjcCpxIaLT8x1fOUqZX_M-8olJfrw",
      authDomain: "sjcj-site.firebaseapp.com",
      projectId: "sjcj-site",
      storageBucket: "sjcj-site.firebasestorage.app",
      messagingSenderId: "518949071104",
      appId: "1:518949071104:web:a5cf6e80b3a66f6e8f6be5"
    };

    // Chargement simple et sûr de Firebase
    const script = document.createElement("script");
    script.src = "https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js";
    script.onload = () => {
      const script2 = document.createElement("script");
      script2.src = "https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js";
      script2.onload = () => start();
      document.body.appendChild(script2);
    };
    document.body.appendChild(script);

    function start() {
      firebase.initializeApp(firebaseConfig);
      const db = firebase.firestore();

      // Récupère le code élève proprement
      let code = window.location.pathname.split("/").pop();
      if (code.endsWith("/")) code = code.slice(0, -1);
      if (!code) { document.getElementById("body").innerHTML = "<h3 class='text-danger text-center'>Code manquant</h3>"; return; }

      const MATIERES = {
        "1ere F4": ["FRANÇAIS","ANGLAIS","MATH","PCT","RDM","PE","DESSIN","SMC","TP","METRE","HYGIENE","PC"],
        "2nde F4": ["FRANÇAIS","ANGLAIS","MATH","PHYSIQUE","DESSIN","INFORMATIQUE","TM/TC","TP","MECANIQUE","PREVENTION","LEGIS"],
        "Tle F4": ["FRANÇAIS","ANGLAIS","MATH","PCT","RDM","PE","DESSIN","METRE","PC","BA","TP","LEGIS"],
        "2nde IMI": ["FRANÇAIS","ANGLAIS","MATH","EB","LA","AS","SEV","SER","ALGO","MATH APPLIQUE","LEGIS"],
        "Tle IMI": ["FRANÇAIS","ANGLAIS","MATH","EB","RESEAU","RP","MATH APPLIQUÉ","LEGIS","BD","PG","ELEC"]
        // ajoute les autres si besoin
      };

      db.collection("eleves").doc(code).get()
        .then(doc => {
          if (!doc.exists) throw "Élève non trouvé";
          const e = doc.data();
          document.getElementById("classe").textContent = e.classe || "...";

          let rows = "";
          (MATIERES[e.classe] || []).forEach(m => {
            rows += `<tr><td class="text-start fw-bold">${m}</td><td>—</td><td>—</td><td>—</td><td>—</td><td class="bg-light fw-bold">—</td><td>—</td><td>—</td><td class="bg-light fw-bold">—</td><td><span class="badge bg-secondary">—</span></td><td>—</td></tr>`;
          });

          document.getElementById("body").innerHTML = `
            <div class="text-center mb-4"><h4>${e.prenom} ${e.nom} • ${e.code_eleve}</h4></div>
            <table class="table table-bordered table-sm">
              <thead class="table-dark">
                <tr><th rowspan="2">Matières</th><th colspan="4">INTERROGATIONS</th><th rowspan="2">Moy.Inter</th><th colspan="2">DEVOIRS</th><th rowspan="2">Moy.Devoirs</th><th rowspan="2">Moy.Semestre</th><th rowspan="2">Appréciation</th></tr>
                <tr><th>1</th><th>2</th><th>3</th><th>4</th><th>1</th><th>2</th></tr>
              </thead>
              <tbody>${rows}</tbody>
            </table>
            <div class="text-center mt-4 no-print">
              <a href="/eleves/rechercher/" class="btn btn-secondary btn-lg">Retour</a>
              <button onclick="window.print()" class="btn btn-success btn-lg ms-3">PDF / Imprimer</button>
            </div>`;
        })
        .catch(err => {
          document.getElementById("body").innerHTML = `<h3 class="text-danger text-center">Erreur : ${err}</h3>`;
        });
    }
  </script>
</body>
</html>
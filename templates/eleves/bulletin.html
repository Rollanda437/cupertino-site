<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bulletin</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        @media print { body { -webkit-print-color-adjust: exact; font-size: 10px; } .no-print { display: none; } }
        .header { background: linear-gradient(135deg, #003366, #0055A4); color: white; padding: 20px; border-radius: 12px 12px 0 0; }
        .table th, .table td { padding: 6px !important; text-align: center; vertical-align: middle; font-size: 11px; }
    </style>
</head>
<body class="bg-light">
<div class="container py-5">
    <div class="card shadow-lg border-0">
        <div class="header text-center">
            <h1 class="mb-1">COLLÈGE SAINT JOSEPH DE CUPERTINO JUNIOR</h1>
            <h3 class="mb-0">FICHE DE NOTES • <span id="classe">...</span> • S1 2025-2026</h3>
        </div>
        <div class="card-body" id="content">
            <div class="text-center my-5">
                <div class="spinner-border text-primary" style="width: 4rem; height: 4rem;"></div>
                <h4 class="mt-3">Chargement du bulletin...</h4>
            </div>
        </div>
    </div>
</div>

<!-- Version Firebase v9 compat qui marche PARTOUT -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
<script>
const firebaseConfig = {
  apiKey: "AIzaSyCEbcDjcCpxIaLT8x1fOUqZX_M-8olJfrw",
  authDomain: "sjcj-site.firebaseapp.com",
  projectId: "sjcj-site",
  storageBucket: "sjcj-site.firebasestorage.app",
  messagingSenderId: "518949071104",
  appId: "1:518949071104:web:a5cf6e80b3a66f6e8f6be5"
};

firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();

const code = window.location.pathname.split('/').pop().replace('/', '');

const MATIERES = {
  "1ere F4": ["FRANÇAIS","ANGLAIS","MATH","PCT","RDM","PE","DESSIN","SMC","TP","METRE","HYGIENE","PC"],
  "2nde F4": ["FRANÇAIS","ANGLAIS","MATH","PHYSIQUE","DESSIN","INFORMATIQUE","TM/TC","TP","MECANIQUE","PREVENTION","LEGIS"],
  "Tle F4": ["FRANÇAIS","ANGLAIS","MATH","PCT","RDM","PE","DESSIN","METRE","PC","BA","TP","LEGIS"],
  "2nde IMI": ["FRANÇAIS","ANGLAIS","MATH","EB","LA","AS","SEV","SER","ALGO","MATH APPLIQUE","LEGIS"],
  "Tle IMI": ["FRANÇAIS","ANGLAIS","MATH","EB","RESEAU","RP","MATH APPLIQUÉ","LEGIS","BD","PG","ELEC"],
  "Tle F3": ["FRANÇAIS","ANGLAIS","MATH","PHYSIQUE","ELECTRO","EST","PRATIQUE","MEL","DESSIN","ANGLAIS"],
  "2nde FC": ["FRANÇAIS","ANGLAIS","MATH","EPS","PHYSIQUE","HIST-GEO","PHYSIQUE APPLIQUE","AUTOMATISME","DESSIN","ELECTRO DE BASE"],
  "1ere HR": ["FRANÇAIS","ANGLAIS","MATH","TC","SAAH","ECONOMAT","TRB","DROIT","MERCATIQUE","COMPTABILITE"],
  "2nde F3": ["FRANÇAIS","ANGLAIS","MATH","PCT","TECHNO","SCHÉMA","DESSIN","ELECTRO","PRATIQUE","MEL"]
};

db.collection("eleves").doc(code).get().then((doc) => {
  if (!doc.exists) {
    document.getElementById("content").innerHTML = "<h3 class='text-danger text-center'>Élève non trouvé</h3>";
    return;
  }
  const e = doc.data();
  document.getElementById("classe").textContent = e.classe;

  const matieres = MATIERES[e.classe] || [];
  let rows = "";
  matieres.forEach(m => {
    rows += `<tr><td class="text-start fw-bold">${m}</td><td>—</td><td>—</td><td>—</td><td>—</td><td class="bg-light">—</td><td>—</td><td>—</td><td class="bg-light">—</td><td><span class="badge bg-secondary">—</span></td><td>—</td></tr>`;
  });

  document.getElementById("content").innerHTML = `
    <div class="row mb-4 text-center">
      <div class="col-12">
        <h4>Élève : <strong>${e.prenom} ${e.nom}</strong> • Code : <strong>${e.code_eleve}</strong></h4>
      </div>
    </div>
    <div class="table-responsive">
      <table class="table table-bordered table-sm">
        <thead class="table-dark">
          <tr><th rowspan="2">Matières</th><th colspan="4">INTERROGATIONS</th><th rowspan="2" class="bg-info text-white">Moy. Inter</th>
              <th colspan="2">DEVOIRS</th><th rowspan="2" class="bg-warning text-dark">Moy. Devoirs</th>
              <th rowspan="2" class="bg-success text-white">Moy. Semestre</th><th rowspan="2">Appréciation</th></tr>
          <tr><th>1</th><th>2</th><th>3</th><th>4</th><th>1</th><th>2</th></tr>
        </thead>
        <tbody>${rows}</tbody>
      </table>
    </div>
    <div class="text-center mt-4 no-print">
      <a href="/eleves/rechercher/" class="btn btn-secondary btn-lg">Retour</a>
      <button onclick="window.print()" class="btn btn-success btn-lg ms-3">PDF / Imprimer</button>
    </div>
  `;
}).catch(() => {
  document.getElementById("content").innerHTML = "<h3 class='text-danger text-center'>Erreur de connexion</h3>";
});
</script>
</body>
</html>
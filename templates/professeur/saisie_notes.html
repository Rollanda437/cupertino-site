<!DOCTYPE html>
<html>
<head>
  <title>Saisie notes – Accès réservé</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>body {background:#f8f9fa; padding:50px;}</style>
</head>
<body>
<div class="container">
  <div class="card shadow col-md-10 mx-auto">
    <div class="card-header bg-danger text-white text-center">
      <h3>SAISIE DES NOTES – ADMIN SEULE</h3>
    </div>
    <div class="card-body">
      <div class="mb-3">
        <label>Mot de passe (celui que tu veux)</label>
        <input type="password" id="mdp" class="form-control" placeholder="Entre le mot de passe secret">
        <button onclick="verifier()" class="btn btn-success mt-2">ACCÉDER</button>
      </div>
      <div id="interface" style="display:none">
        <div class="mb-3">
          <input type="text" id="code" class="form-control" placeholder="Code élève (ex: 26A0204)">
          <button onclick="charger()" class="btn btn-primary mt-2">Charger l’élève</button>
        </div>
        <div id="tableau"></div>
        <button onclick="sauvegarder()" class="btn btn-success btn-lg mt-3">SAUVEGARDER LES NOTES</button>
      </div>
    </div>
  </div>
</div>

<script>
const MDP_CORRECT = "sjcj2026"; // Change ça par le mot de passe que tu veux

function verifier() {
  if (document.getElementById("mdp").value === MDP_CORRECT) {
    document.getElementById("interface").style.display = "block";
    document.getElementById("mdp").parentElement.style.display = "none";
  } else alert("Mot de passe incorrect");
}

async function charger() {
  const code = document.getElementById("code").value.trim();
  if (!code) return alert("Entre un code élève");
  
  const csv = await fetch("https://raw.githubusercontent.com/tonpseudo/tonrepo/main/eleves_import.csv").then(r=>r.text());
  const eleve = csv.split("\n").find(l => l.startsWith(code));
  if (!eleve) return alert("Élève non trouvé");
  const [,prenom,nom,classe] = eleve.split(",");
  
  const matieres = {
    "1ere F4": ["FRANÇAIS","ANGLAIS","MATH","PCT","RDM","PE","DESSIN","SMC","TP","METRE","HYGIENE","PC"],
    "2nde F4": ["FRANÇAIS","ANGLAIS","MATH","PHYSIQUE","DESSIN","INFORMATIQUE","TM/TC","TP","MECANIQUE","PREVENTION","LEGIS"],
    "Tle F4": ["FRANÇAIS","ANGLAIS","MATH","PCT","RDM","PE","DESSIN","METRE","PC","BA","TP","LEGIS"],
    "2nde IMI": ["FRANÇAIS","ANGLAIS","MATH","EB","LA","AS","SEV","SER","ALGO","MATH APPLIQUE","LEGIS"],
    "Tle IMI": ["FRANÇAIS","ANGLAIS","MATH","EB","RESEAU","RP","MATH APPLIQUÉ","LEGIS","BD","PG","ELEC"],
    "Tle F3": ["FRANÇAIS","ANGLAIS","MATH","PHYSIQUE","ELECTRO","EST","PRATIQUE","MEL","DESSIN","ANGLAIS"],
    "2nde FC": ["FRANÇAIS","ANGLAIS","MATH","EPS","PHYSIQUE","HIST-GEO","PHYSIQUE APPLIQUE","AUTOMATISME","DESSIN","ELECTRO DE BASE"],
    "1ere HR": ["FRANÇAIS","ANGLAIS","MATH","TC","SAAH","ECONOMAT","TRB","DROIT","MERCATIQUE","COMPTABILITE"],
    "2nde F3": ["FRANÇAIS","ANGLAIS","MATH","PCT","TECHNO","SCHÉMA","DESSIN","ELECTRO","PRATIQUE","MEL"],
    "1ere F3": ["FRANÇAIS","ANGLAIS","MATH","PCT","TECHNO","SCHÉMA","DESSIN","ELECTRO","PRATIQUE","MEL"]
  };

  let html = `<h4 class="text-center text-success">${prenom} ${nom} – ${classe}</h4>
  <table class="table table-bordered"><thead class="table-dark">
  <tr><th>Matière</th><th>I1</th><th>I2</th><th>I3</th><th>I4</th><th>D1</th><th>D2</th><th>Appréciation</th></tr></thead><tbody>`;

  matieres[classe].forEach(m => {
    html += `<tr>
      <td><strong>${m}</strong></td>
      <td><input type="number" min="0" max="20" step="0.1" class="form-control form-control-sm" data-m="${m}" data-f="i1"></td>
      <td><input type="number" min="0" max="20" step="0.1" class="form-control form-control-sm" data-m="${m}" data-f="i2"></td>
      <td><input type="number" min="0" max="20" step="0.1" class="form-control form-control-sm" data-m="${m}" data-f="i3"></td>
      <td><input type="number" min="0" max="20" step="0.1" class="form-control form-control-sm" data-m="${m}" data-f="i4"></td>
      <td><input type="number" min="0" max="20" step="0.1" class="form-control form-control-sm" data-m="${m}" data-f="d1"></td>
      <td><input type="number" min="0" max="20" step="0.1" class="form-control form-control-sm" data-m="${m}" data-f="d2"></td>
      <td><input type="text" class="form-control form-control-sm" data-m="${m}" data-f="app"></td>
    </tr>`;
  });
  html += `</tbody></table>`;
  document.getElementById("tableau").innerHTML = html;
}

function sauvegarder() {
  const notes = {};
  document.querySelectorAll("#tableau input").forEach(i => {
    const m = i.dataset.m;
    const f = i.dataset.f;
    if (!.notes[m]) notes[m] = {};
    if (i.value) notes[m][f] = i.value;
  });
  const data = JSON.stringify(notes, null, 2);
  const blob = new Blob([data], {type: "application/json"});
  const url = URL.createObjectURL(blob);
  const a = document.createElement("a");
  a.href = url; a.download = document.getElementById("code").value + ".json";
  a.click();
  alert("Notes sauvegardées dans le fichier " + a.download);
}
</script>
</body>
</html>